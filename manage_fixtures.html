<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manage Fixtures - Fresh Hub</title>
  <link rel="stylesheet" href="style5.css" />
</head>
<body>

  <header class="header">
    <div class="header-content">
      <h2>Manage Fixtures</h2>
      <button onclick="logout()">Logout</button>
    </div>
  </header>

  <main style="margin-top: 130px; padding: 20px;">
    <h3>Add New Fixture</h3>
    <form id="fixtureForm">
      <input type="text" id="date" placeholder="Date (e.g. 2025-05-21)" required />
      <input type="text" id="match" placeholder="Match (e.g. Team A vs Team B)" required />
      <input type="text" id="timeResults" placeholder="Time or Result" required />
      <input type="text" id="matchDay" placeholder="Match Day" required />
      <select id="category">
        <option value="today">Today</option>
        <option value="upcoming">Upcoming</option>
        <option value="past">Past</option>
      </select>
      <button type="submit">Add Fixture</button>
    </form>

    <h3 style="margin-top: 40px;">Current Fixtures (Today)</h3>
    <ul id="fixtureList"></ul>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      onValue,
      remove
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBWUjKRUpiLmwRi7UjQ5l_zCJ1YOGsaIg0",
      authDomain: "fresh-hub-d509f.firebaseapp.com",
      databaseURL: "https://fresh-hub-d509f-default-rtdb.firebaseio.com",
      projectId: "fresh-hub-d509f",
      storageBucket: "fresh-hub-d509f.appspot.com",
      messagingSenderId: "101887757266",
      appId: "1:101887757266:web:80c054959f6588771fd60b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    // Auth check
    onAuthStateChanged(auth, (user) => {
      if (!user || user.email !== "freshcoindrop@gmail.com") {
        alert("Access denied.");
        window.location.href = "admin-login.html";
      }
    });

    const fixtureForm = document.getElementById('fixtureForm');
    const fixtureList = document.getElementById('fixtureList');

    fixtureForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const date = fixtureForm.date.value;
      const match = fixtureForm.match.value;
      const timeResults = fixtureForm.timeResults.value;
      const matchDay = fixtureForm.matchDay.value;
      const category = fixtureForm.category.value;

      const newFixture = {
        date,
        match,
        timeResults,
        matchDay
      };

      const fixtureRef = ref(db, `fixtures/${category}`);
      push(fixtureRef, newFixture).then(() => {
        fixtureForm.reset();
        alert("Fixture added!");
      });
    });

    const loadFixtures = () => {
      const todayRef = ref(db, 'fixtures/today');
      onValue(todayRef, (snapshot) => {
        fixtureList.innerHTML = '';
        const data = snapshot.val();
        if (data) {
          Object.entries(data).forEach(([key, fixture]) => {
            const li = document.createElement('li');
            li.textContent = `${fixture.date} - ${fixture.match} - ${fixture.timeResults} - ${fixture.matchDay}`;
            const delBtn = document.createElement('button');
            delBtn.textContent = "Delete";
            delBtn.onclick = () => {
              remove(ref(db, `fixtures/today/${key}`));
            };
            li.appendChild(delBtn);
            fixtureList.appendChild(li);
          });
        }
      });
    };

    loadFixtures();

    // Logout
    window.logout = () => {
      signOut(auth).then(() => {
        window.location.href = 'login.html';
      });
    };
  </script>
</body>
</html>