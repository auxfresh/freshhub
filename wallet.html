<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wallet</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 20px; }
    .wallet { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
    .logo { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; }
    .balance { font-size: 24px; margin-top: 10px; font-weight: bold; }
    .actions button { margin: 10px 5px; padding: 10px 20px; border: none; background: #007bff; color: white; border-radius: 5px; cursor: pointer; }
    .actions button:hover { background: #0056b3; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 10px; max-width: 400px; width: 90%; }
    .history { margin-top: 20px; }
    .history-item { padding: 10px; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>

<div class="wallet">
  <div id="userInfo">
    <img id="teamLogo" class="logo" src="" alt="Team Logo"/>
    <div id="teamName">Team Name</div>
    <div id="username">Username</div>
    <div class="balance" id="balance">₦0</div>
  </div>
  <div class="actions">
    <button onclick="showModal('sendModal')">Send</button>
    <button onclick="showModal('receiveModal')">Receive</button>
    <button onclick="showModal('withdrawModal')">Withdraw</button>
  </div>

  <div class="history">
    <h3>Transaction History</h3>
    <div id="transactions"></div>
  </div>
</div>

<!-- Send Modal -->
<div id="sendModal" class="modal">
  <div class="modal-content">
    <h3>Send Money</h3>
    <input id="sendToUser" placeholder="Recipient Username" />
    <input id="sendAmount" type="number" placeholder="Amount" />
    <button onclick="sendMoney()">Send</button>
    <button onclick="hideModal('sendModal')">Close</button>
  </div>
</div>

<!-- Receive Modal -->
<div id="receiveModal" class="modal">
  <div class="modal-content">
    <h3>Receive Info</h3>
    <p>Tell others to send to: <strong id="receiveUsername"></strong></p>
    <button onclick="hideModal('receiveModal')">Close</button>
  </div>
</div>

<!-- Withdraw Modal -->
<div id="withdrawModal" class="modal">
  <div class="modal-content">
    <h3>Withdraw</h3>
    <p>Withdrawal functionality coming soon.</p>
    <button onclick="hideModal('withdrawModal')">Close</button>
  </div>
</div>

<!-- Firebase & EmailJS -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBWUjKRUpiLmwRi7UjQ5l_zCJ1YOGsaIg0",
      authDomain: "fresh-hub-d509f.firebaseapp.com",
      databaseURL: "https://fresh-hub-d509f-default-rtdb.firebaseio.com",
      projectId: "fresh-hub-d509f",
      storageBucket: "fresh-hub-d509f.appspot.com",
      messagingSenderId: "101887757266",
      appId: "1:101887757266:web:80c054959f6588771fd60b"
    };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  emailjs.init("017c9GlwpBSK92Tuv"); // Replace with your EmailJS public key

  <!-- Only changed parts shown below (rest is same) -->

<script>
  const username = localStorage.getItem("username");

  async function loadWallet() {
    if (!username) return;
    document.getElementById("username").innerText = username;
    document.getElementById("receiveUsername").innerText = username;

    const userRef = db.ref(`/balance/teams/${username}`);
    const userSnap = await userRef.get();
    const userData = userSnap.val();
    if (userData) {
      document.getElementById("balance").innerText = `₦${userData.balance || 0}`;
      const transactions = userData.transactions || {};
      const txContainer = document.getElementById("transactions");
      txContainer.innerHTML = "";
      Object.values(transactions).reverse().forEach(tx => {
        const div = document.createElement("div");
        div.className = "history-item";
        div.innerText = `${tx.type === "send" ? "Sent" : "Received"} ₦${tx.amount} ${tx.type === "send" ? "to" : "from"} ${tx.type === "send" ? tx.to : tx.from}`;
        txContainer.appendChild(div);
      });
    }

    const teamRef = db.ref(`/details/teams/${username}`);
    const teamSnap = await teamRef.get();
    const teamData = teamSnap.val();
    if (teamData) {
      document.getElementById("teamName").innerText = teamData.name;
      document.getElementById("teamLogo").src = teamData.logo || "";
    }
  }

  window.sendMoney = async () => {
    const toUser = document.getElementById("sendToUser").value.trim();
    const amount = parseFloat(document.getElementById("sendAmount").value);

    if (!toUser || !amount || amount <= 0) return alert("Enter valid recipient and amount");

    const senderRef = db.ref(`/balance/teams/${username}`);
    const receiverRef = db.ref(`/balance/teams/${toUser}`);

    const [senderSnap, receiverSnap] = await Promise.all([senderRef.get(), receiverRef.get()]);

    if (!receiverSnap.exists()) return alert("Recipient does not exist");

    const senderBal = senderSnap.val()?.balance || 0;
    const receiverBal = receiverSnap.val()?.balance || 0;

    if (senderBal < amount) return alert("Insufficient balance");

    await senderRef.update({ balance: senderBal - amount });
    await receiverRef.update({ balance: receiverBal + amount });

    const transaction = {
      type: 'send',
      from: username,
      to: toUser,
      amount,
      timestamp: new Date().toISOString()
    };

    const senderTxRef = db.ref(`/balance/teams/${username}/transactions`);
    const receiverTxRef = db.ref(`/balance/teams/${toUser}/transactions`);
    const txKey = senderTxRef.push().key;

    await senderTxRef.child(txKey).set(transaction);
    await receiverTxRef.child(txKey).set({ ...transaction, type: "receive" });

    alert("Transaction successful");
    hideModal("sendModal");
    loadWallet();

    // Send Email to Sender
    emailjs.send("service_cvgwdjb", "template_9yx9srx", {
      to_name: username,
      message: `You have successfully sent ₦${amount} to ${toUser}.`,
      to_email: senderSnap.val().email
    });

    // Send Email to Receiver
    emailjs.send("service_cvgwdjb", "template_9yx9srx", {
      to_name: toUser,
      message: `You have received ₦${amount} from ${username}.`,
      to_email: receiverSnap.val().email
    });
  };
</script>
  window.onload = loadWallet;
</script>
</body>
</html>
